
# cl-polyhedral

> This project is still in the early stage! As of this writing features are not complete; I think it will take a few more months. Just be patient. :)

cl-polyhedral is a Common Lisp package which provides a **Polyhedral Compilation**. It represents linear algebra operations in terms of polyhedra, optimizing them in an equivalence representation, and (to be) allowing:

- [ ] Auto Parameter Tuning, especially, Tiling (for CPU)

- [ ] Loop structure analysis, Automatic parallelization

- [ ] Loop Reordering, aiming to the memory-locality optimization.

- [ ] Autogenerated SIMDified Code.

- [ ] cl-polyhedral can be directly embedded in your Common Lisp Code, JIT Compilers are working on the any language you like!

- [ ] (To be) applied into the implementation of `cl-einsum`, an optimizing einsum implementation of Common Lisp.

Obviously, it dramatically surpercharges matrix operations in Common Lisp!

# What is a polyheldral compilation?

TODO

# Requirements

- ISL

- HWLoc (Optional)

cl-polyhedral widely depends on its implementation on [ISL (Integer Set Library)](https://github.com/Meinersbur/isl) and its dynamic library (.so/.dylib) is called via CFFI. That is, to use cl-polyhedral, to use this library, CFFI must be in a position to find `libisl`.

## Installing ISL

```sh
$ brew install isl
$ sudo apt install libisl-dev
```

## (Another Option) Building from the source

```sh
$ cd ./isl
$ ./autogen.sh
$ CFLAGS="$(pkg-config --libs --cflags gmp)" ./configure --prefix $HOME/usr
$ make -j 8 && make install
```

Ensure CFFI can find out where libisl.dylib was installed.

```sh
# e.g.:
$ locate libisl.dylib
> /opt/homebrew/lib/libisl.dylib
```

## Installing HWLoc

(TODO)

Memo:

- macOS: `brew install hwloc`

- ubuntu: ?

- BSD: ?

- Windows: ?

## Docs

(TODO)

## Extending cl-polyhedral

(TODO)

## Writing a user-defined backend

(TODO)

# Workload

- [ ] Remove Qlot (unused)

- [ ] Docs

- [ ] Improve the quality; more tests!

- [ ] Github Actions

- [ ] Complete implementing all feature

- [ ] Backend-independent scheduling, such as GCC/CUDA/Metal Backend

- [ ] Loop-Fuse Scheduling

- [ ] Finish Implementing Tiling

- [ ] **adapt as a cl-waffe2 backend**

- [ ] **Implementing the fastest einsum in Common Lisp**

# Acknowledgments

- ISL as a solid fondation of Integer Linear Programming, and scheduling.

    - https://libisl.sourceforge.io/manual.pdf

- Slides/Papers

    - https://web.cs.ucla.edu/~pouchet/lectures/doc/888.11.2.pdf
 
    - https://www.slideshare.net/ahayashi10/introduction-to-polyhedral-compilation

- The following libraries are used as reference for implementation.

    - https://github.com/JuliaLabs/Poly.jl/tree/master